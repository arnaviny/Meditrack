<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera Capture with Tesseract.js</title>
    <style>
       /* 注爪  */
body, html {
    margin: 0;
    padding: 0;
    height: 100%;
    display: flex;
    flex-direction: column;
    background-color: #000;
}

/*  爪 */
#camera-container {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
}

/*  */
video {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
}

video, canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
}


/* 驻转专 爪 */
#capture-button {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    width: 70px;
    height: 70px;
    background-color: #ff3b30;
    border: none;
    border-radius: 50%;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    color: white;
    font-size: 30px;
    text-align: center;
    line-height: 70px;
    cursor: pointer;
    z-index: 10;
    transition: transform 0.2s, box-shadow 0.2s;
}

#capture-button:active {
    transform: scale(1.2);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
}

/*  砖拽祝 */
#focus-box {
    position: absolute;
    top: 45%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 70%;
    height: 57%;
    border: 2px solid white;
    box-shadow: 0 0 10px 267px rgb(0 0 0 / 56%);
    z-index: 3;
    pointer-events: none;
}
#result-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    color: white;
    background-color: rgba(0, 0, 0, 0.8);
}

#result-container p {
    font-size: 20px;
    margin: 10px 0;
}

#result-container button {
    margin: 10px;
    padding: 10px 20px;
    font-size: 16px;
    background-color: #57e772;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

    </style>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@v2.1.4/dist/tesseract.min.js"></script>
</head>
<body>
    <div id="camera-container">
        <div id="overlay">
            <div id="focus-box"></div>
        </div>
        <video id="video" autoplay playsinline></video>
        <button id="capture-button"></button>
        <canvas id="canvas" style="display:none;"></canvas>
    </div>

    <div id="result-container" style="display:none;">
        <p id="recognized-name"></p>
        <p id="recognized-id"></p>
        <button id="retry-button">Retry</button>
        <button id="save-button">Save</button>
    </div>

    <script>
        const video = document.getElementById('video');
        const captureButton = document.getElementById('capture-button');
        const canvas = document.getElementById('canvas');
        const context = canvas.getContext('2d');
        const resultContainer = document.getElementById('result-container');
        const recognizedName = document.getElementById('recognized-name');
        const recognizedID = document.getElementById('recognized-id');
        const retryButton = document.getElementById('retry-button');
        const saveButton = document.getElementById('save-button');
    
        let stream = null;
    
        // 驻注转 爪
        navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
            .then(videoStream => {
                stream = videoStream;
                video.srcObject = stream;
            })
            .catch(err => {
                console.error("Error accessing the camera:", err);
                alert(" 转 砖转 爪. 拽 专砖转.");
            });
    
        // 驻拽爪 注 转: 拽专住, 砖砖 
        function enhanceImage(canvas) {
            const ctx = canvas.getContext('2d');
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
    
            // 拽专住 
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, data[i] * 1.5);     // 
                data[i + 1] = Math.min(255, data[i + 1] * 1.5); // 专拽
                data[i + 2] = Math.min(255, data[i + 2] * 1.5); // 
            }
    
            // 砖砖 拽 (爪注 砖)
            for (let y = 1; y < canvas.height - 1; y++) {
                for (let x = 1; x < canvas.width - 1; x++) {
                    const idx = (y * canvas.width + x) * 4;
                    data[idx] = (data[idx - 4] + data[idx] + data[idx + 4]) / 3; // 
                    data[idx + 1] = (data[idx - 3] + data[idx + 1] + data[idx + 5]) / 3; // 专拽
                    data[idx + 2] = (data[idx - 2] + data[idx + 2] + data[idx + 6]) / 3; // 
                }
            }
    
            ctx.putImageData(imageData, 0, 0);
        }
    
        // 拽转 转 爪 注 驻转专
        captureButton.addEventListener('click', () => {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
    
            enhanceImage(canvas); // 砖驻专 转
    
            // 爪 转 转 砖爪
            video.style.display = 'none'; // 住转专转 
            canvas.style.display = 'block'; // 爪转 转
    
            // 注 注 Tesseract.js  砖 住驻专 砖
            const image = canvas.toDataURL('image/jpeg');
            captureButton.disabled = true; // 注转 爪 住驻转 注 住 注
            captureButton.textContent = "注..."; // 砖 拽住 驻转专
    
            Tesseract.recognize(
                image,
                'heb+eng',
                { logger: info => console.log(info) }
            ).then(({ data: { text } }) => {
                const lines = text.split('\n');
    
                //  拽住 驻 "砖" "住驻专 砖"
                const nameLine = lines.find(line => line.includes("砖"));
                const idLine = lines.find(line => line.includes("住驻专 砖"));
    
                const name = nameLine ? nameLine.replace("砖", "").trim() : "砖  ";
                const id = idLine ? idLine.replace("住驻专 砖", "").trim() : "住驻专 砖  ";
    
                recognizedName.textContent = `砖: ${name}`;
                recognizedID.textContent = `住驻专 砖: ${id}`;
    
                // 注专 转爪转
                canvas.style.display = 'none'; // 住转专转 转
                resultContainer.style.display = 'flex'; // 爪转 转爪
            }).catch(err => {
                console.error("砖  注 -OCR:", err);
                alert("砖  转.");
                captureButton.disabled = false; // 驻注转 驻转专 砖
                captureButton.textContent = ""; // 砖专 拽住 拽专 驻转专
            });
        });
    
        // 驻转专 "爪 砖"
        retryButton.addEventListener('click', () => {
            location.reload(); // 注 砖 转 祝
        });
    
        // 驻转专 "砖专"
        saveButton.addEventListener('click', () => {
            const nameAndID = {
                name: recognizedName.textContent.replace("砖: ", ""),
                ID: recognizedID.textContent.replace("住驻专 砖: ", "")
            };
            console.log("转 砖砖专:", nameAndID);
    
            // 专 祝 拽 注 转
            history.back(); // 专 转 砖转砖 祝 拽
        });
    </script>
    
    
        
</body>
</html>


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera Capture with Tesseract.js</title>
    <style>
       /* 注爪  */
body, html {
    margin: 0;
    padding: 0;
    height: 100%;
    display: flex;
    flex-direction: column;
    background-color: #000;
}

/*  爪 */
#camera-container {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
}

/*  */
video {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
}

video, canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
}


/* 驻转专 爪 */
#capture-button {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    width: 70px;
    height: 70px;
    background-color: #ff3b30;
    border: none;
    border-radius: 50%;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    color: white;
    font-size: 30px;
    text-align: center;
    line-height: 70px;
    cursor: pointer;
    z-index: 10;
    transition: transform 0.2s, box-shadow 0.2s;
}

#capture-button:active {
    transform: scale(1.2);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
}

/*  砖拽祝 */
#focus-box {
    position: absolute;
    top: 45%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 70%;
    height: 57%;
    border: 2px solid white;
    box-shadow: 0 0 10px 267px rgb(0 0 0 / 56%);
    z-index: 3;
    pointer-events: none;
}
#result-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    color: white;
    background-color: rgba(0, 0, 0, 0.8);
}

#result-container p {
    font-size: 20px;
    margin: 10px 0;
}

#result-container button {
    margin: 10px;
    padding: 10px 20px;
    font-size: 16px;
    background-color: #57e772;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

    </style>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@v2.1.4/dist/tesseract.min.js"></script>
</head>
<body>
    <div id="camera-container">
        <div id="overlay">
            <div id="focus-box"></div>
        </div>
        <video id="video" autoplay playsinline></video>
        <button id="capture-button"></button>
        <canvas id="canvas" style="display:none;"></canvas>
    </div>

    <div id="result-container" style="display:none;">
        <p id="recognized-name"></p>
        <p id="recognized-id"></p>
        <button id="retry-button">Retry</button>
        <button id="save-button">Save</button>
    </div>

    <script>
        const video = document.getElementById('video');
const captureButton = document.getElementById('capture-button');
const canvas = document.getElementById('canvas');
const context = canvas.getContext('2d');
const resultContainer = document.getElementById('result-container');
const recognizedName = document.getElementById('recognized-name');
const recognizedID = document.getElementById('recognized-id');
const retryButton = document.getElementById('retry-button');
const saveButton = document.getElementById('save-button');

let stream = null;

// 驻注转 爪
navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
    .then(videoStream => {
        stream = videoStream;
        video.srcObject = stream;
    })
    .catch(err => {
        console.error("Error accessing the camera:", err);
        alert(" 转 砖转 爪. 拽 专砖转.");
    });

// 拽转 转 爪 注 驻转专
captureButton.addEventListener('click', () => {
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    context.drawImage(video, 0, 0, canvas.width, canvas.height);

    function preprocessImage(canvas) {
    const ctx = canvas.getContext('2d');
    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);

    // 驻转 转  驻专
    for (let i = 0; i < imageData.data.length; i += 4) {
        const avg = (imageData.data[i] + imageData.data[i + 1] + imageData.data[i + 2]) / 3;
        imageData.data[i] = avg; // 
        imageData.data[i + 1] = avg; // 专拽
        imageData.data[i + 2] = avg; // 
    }

    ctx.putImageData(imageData, 0, 0);
}

    // 爪 转 转 砖爪
    video.style.display = 'none'; // 住转专转 
    canvas.style.display = 'block'; // 爪转 转

    // 注 注 Tesseract.js
    const image = canvas.toDataURL('image/jpeg');
    captureButton.disabled = true; // 注转 爪 住驻转 注 住 注
    captureButton.textContent = "Processing..."; // 砖 拽住 驻转专

    Tesseract.recognize(
        image,
        'heb', // 转祝 -'heb'  转  注专转
        { logger: info => console.log(info) }
    ).then(({ data: { text } }) => {
        // 爪转 砖 住驻专 砖
        const lines = text.split('\n');
        const name = lines.find(line => line.match(/[\u0590-\u05FF\s]+/)) || "Unknown Name"; // 转 注专转
        const id = lines.find(line => line.match(/^\d{7,10}$/)) || "Unknown ID"; // 住驻专 转"


        recognizedName.textContent = `Name: ${name}`;
        recognizedID.textContent = `ID: ${id}`;

        // 注专 转爪转
        canvas.style.display = 'none'; // 住转专转 转
        resultContainer.style.display = 'flex'; // 爪转 转爪
    }).catch(err => {
        console.error("Error during OCR:", err);
        alert("砖  转.");
        captureButton.disabled = false; // 驻注转 驻转专 砖
        captureButton.textContent = ""; // 砖专 拽住 拽专 驻转专
    });
});

// 驻转专 "爪 砖"
retryButton.addEventListener('click', () => {
    location.reload(); // 注 砖 转 祝
});

// 驻转专 "砖专"
saveButton.addEventListener('click', () => {
    const nameAndID = {
        name: recognizedName.textContent.replace("Name: ", ""),
        ID: recognizedID.textContent.replace("ID: ", "")
    };
    console.log("Saved Data:", nameAndID);

    // 专 祝 拽 注 转
    history.back(); // 专 转 砖转砖 祝 拽
});
    </script>
</body>
</html>

